name: Build Java Images

on:
  workflow_dispatch:


jobs:
  just-test:
    runs-on: ubuntu-latest    
    steps:
      - name: Build Placeholder
        run: |
          echo "-------------------------------------------------------"
          echo "ðŸš€ Specter Stack: Java Build Pipeline Triggered!"
          echo "Status: Monitoring versions.json for changes..."
          echo "Action: Preparing to build JDK 8, 11, 17, 21, 25"
          echo "Target Architecture: linux/amd64, linux/arm64"
          echo "Bake process will be executed here in the next step."
          echo "-------------------------------------------------------"
  build:
      runs-on: ubuntu-latest
      permissions:
        contents: read
        packages: write
        id-token: write 
      strategy:
        fail-fast: false
        matrix:
          java_version: [17]

      steps:
        - name: Checkout Code
          uses: actions/checkout@v4

        - name: Set up Docker Buildx
          uses: docker/setup-buildx-action@v3

        - name: Login to Docker Hub
          uses: docker/login-action@v3
          with:
            registry: docker.io
            username: ${{ secrets.DOCKERHUB_USERNAME }}
            password: ${{ secrets.DOCKERHUB_PASSWORD }}

        - name: Docker Bake (Build and Push)
          uses: docker/bake-action@v5
          with:
            files: |
              docker-bake.hcl
              versions/${{ matrix.java_version }}/build.hcl
              versions.hcl 
            targets: java${{ matrix.java_version }}
            push: true
